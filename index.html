<HTML>
<head>
    <meta name="viewport" content="width=device-width">
    <link rel="icon" href="https://www.citypng.com/public/uploads/preview/js-javascript-round-logo-icon-png-7017516947717339mnyf7eumy.png">
    <title>Js-Editor</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
</head>
<style>
    #todo{
//margin: 5px;



    }
#editor{
    padding:5px;
width:100%;
height:45%;
//background-color: red;;
//color: white;


}

#container{
//display:inline-block;
  float:right;
  background-color: blue;


}
#canvas{

 }
#menu{
    position: absolute;;
    width: 60%;
    height: 30%;
    top:55%;
    left: 10%;
    background-color: antiquewhite;
    display: none;
    padding: 15px;
    box-shadow: -5px 5px 20px rgba(200,200,200,.95);
    border-style: solid;


}
select{
    width:40%;
    margin: 10px;
}
button{
    width: 40%;
    margin: 10px;
}
#coo{
    width: 100%;
    height:45%;
    overflow:auto;
 
}
#ress{
    display:flex;
 
 bottom:1%;
    width: 300%;
    height: 100%;
    background:white;


}
.els {
 width:33%;
 height:95%;
 margin: 5px;
  border-style: solid;
        box-shadow: -5px 5px 20px rgba(200,200,200,.95);


}
.cbo{
    margin: 10px;
    width: auto;
    background-color: red;
    color: white;
}

</style>
<button onclick="alert(about)" style="position:absolute;top:2%;right:2%;background-color: red;color:white;width: auto;;" >?</button>
<div id="todo">
<textarea id="editor" placeholder="Type your codes here...(for your variables use var *recommended)"></textarea>


<button  onclick="procesar(editor.value)">Process</button>
<button id="onmen" onclick="if(menu.style.display==='block'){menu.style.display='none';this.style.background='#eeeeee'}else {menu.style.display='block';this.style.background='#00ff00'}">Menu</button>
<button class="cbo" onclick="ress.prepend(textarea);coo.scrollLeft = 0;">T</button>
<button class="cbo" onclick="ress.prepend(canvas);coo.scrollLeft = 0;">C</button>
<button class="cbo" onclick="ress.prepend(can3d);coo.scrollLeft = 0;">3</button>
<button class="cbo" onclick="ress.prepend(container);coo.scrollLeft = 0;">D</button>


<div id="coo">
<div id="ress">
<textarea id="textarea" class="els" placeholder=" texarea"></textarea>
<canvas id="canvas" class="els">canvas</canvas>
<canvas id="can3d" class="els">3d canvas</canvas>
<div id="container" class="els" >div testing</div>


</div>
</div>

<div id="menu">
<select id="sselopc" oninput="selopc(this.value)">
 
    <option>Select Option</option>
 
      <option>Save project</option>
      <option>Save project to web</option>    
      <option>Delete actual project</option>
      <option>Set Up 3d Canvas</option>


  
       <option>New project</option>  


<option></option>
     <option>Delete all projects</option>    
</select>


<select id="spr" oninput="selPr(this.value)">
    <option>Select Prtoject</option>
 
</select>
<select id="sexamples">
<option>Select an Example</optn  ion>
<option></option>
</select>
<select id="sweb" oninput="selPrw(this.value)">
<option>Select from Web</option>
<option></option>
</select>
<select id="scanv3d" oninput="if(this.value!='Select a method')insertTx(this.value)">
    <option>Select a method</option>
    <option>esena.add( )</option>
    <option>renderCodes=""</option>
    <option>crDot(params={d:.5,texture:"",color:0xaaaaaa})</option>
    <option>crCube(params={w:1,h:1,d:1,texture:"",color:0xaaaaaa})</option>
  <option>crSphere(params={r:1,segsx:32,segsy:16,texture:"",color:0xaaaaaa})</option>
  <option>crCylinder(params={r1:1,r2:1,long:1,cap:true,segsx:32,segsy:16,texture:"",color:0xaaaaaa})</option>
  <option>crLine(params={arPoints:[[0,0,0],[1,1,1]],color:0xaaaa})</option>








</select>
</div>


<script>
var renderCodes="";
var ctx = canvas.getContext("2d");
ctx.clearRect(0, 0, canvas.width, canvas.height);


m=canvas.getClientRects()[0];
ra=m.height/m.width;

canvas.width = m.width;
canvas.height = m.height;




    link="https://jsonblob.com/api/1387824581984837632"
var arpr=[],actual="",arw=[], obactual=[],from="local";
//localStorage.removeItem("projects")
GetJ(link,function(r){
arw=r;
setupprw()


})




    var ll=localStorage.getItem("projects");
    if(ll!=null){
 
arpr=JSON.parse(ll);


    }


setuppr();
    function setuppr(){
    spr.innerHTML="<option>Select a project</option>"
    for(var i=0;i<arpr.length;i++){
        e=arpr[i];
 
        spr.innerHTML+="<option>"+e.name+"</option>"
 
    }
 
    }
//sessionStorage();
    function setupprw(){
    sweb.innerHTML="<option>Select a web project</option>"
    for(var i=0;i<arw.length;i++){
        e=arw[i];
 
        sweb.innerHTML+="<option>"+e.name+"</option>"
 
    }
 
    }
   
setUp3dCanvas();

function procesar(v){
  //  alert(v)
clrEsena()

    eval(v)
}
function selPr(v){
    actual=v;
     var ind=verifypr(v);
 
    if(ind>-1) {
        obactual=arpr[ind];
        from="local"
 
        editor.value=arpr[ind].cont;
        procesar(editor.value);
     //   selPr.value="Select a project";
    }
}
function selopc(v){


 
     if(v==="Save project to web") {
        var n=obactual.name;
 
          //  if(n===undefined){
                var n=prompt("Type project name",n);
                if(n===null) return;
                if(n!="") obactual={name:n,cont:editor.value}
                else {alert("Wrong name, try again");return;}


          //  }

          verifyprw(n,function(ind){
      
            if(ind==-1){
             
      if(confirm("This project will be sent to web, are you sure?")){


        arw.push(obactual);
        UpdateJ(link,arw,function(){alert("Project "+obactual.name+"  has been saved in web");setupprw()})


        }
    }
    else{


    if(confirm("Project already exist in web, do you want to replace it?")){
        arw[ind].cont=editor.value;
     UpdateJ(link,arw,function(){alert("Project "+obactual.name+" has been saved in web")})
     alert("Project "+n+" has been updated");


    }

    }
    })
       
      }

      if(v==="Set Up 3d Canvas") {setUp3dCanvas();}
      
       if(v==="New project") {obactual={};editor.value="";textarea.value="";actual=""}
       if(v==="Delete all projects"){


        if(confirm("Are you sure you want to delete all local projects?")){
            if(confirm("I am ready to delete all projects, proceed?")){
                
                localStorage.removeItem("projects");
                alert("App will restart");
                window.location.reload();
            }
        }
    }
    if(v==="Delete actual project"){
        
        var s="";
        if(from!="local"){
            verifyprw(sweb.value,function(ind){
                if(ind>-1 && confirm("Project found, do you want to proceed deleting it?")){
                arw.splice(ind,1);
 
                       UpdateJ(link,arw,function(){alert("Project has been deleted from web/n/nThe app will restart"); window.location.reload();})

           } 
        })

        }
        else{
            var ind=verifypr(spr.value);
            if(ind>-1 && confirm("Project local found, do you want to proceed deleting it?")){
                                  arpr.splice(ind,1);  
                localStorage.setItem("projects",JSON.stringify(arpr));
                alert("Project has been deleted, app will restart");
                 window.location.reload();
}
        }


    }
if(v==="Save project"){


    var n=prompt("Type project name",actual);
    var ind=verifypr(n)
    if(ind===-1){
 
var o={};
o.name=n;
o.cont=editor.value;
arpr.push(o);
//alert(JSON.stringify(arpr));
localStorage.setItem("projects",JSON.stringify(arpr));
alert("Project "+n+" has been saved locally")
setuppr();


    }
else {
    if(confirm("Project already exist, do you want to replace it?")){
        arpr[ind].cont=editor.value;
     localStorage.setItem("projects",JSON.stringify(arpr));  
     alert("Project "+n+" has been updated");


    }


}


}
setTimeout('sselopc.value="Select Option"',1500);
}


function verifypr(v,ar){
    ///aqui
      for(var i=0;i<arpr.length;i++){
        var e=arpr[i];
        if(e.name===v){
            return i;
        }
    }
    return -1;
}


function verifyprw(v,callback){

GetJ(link,function(r){
arw=r;

     for(var i=0;i<arw.length;i++){
        var e=arw[i];
      
        if(e.name===v){
            
              if(callback!=undefined) callback(i)
            return i;
        }
    }
if(callback!=undefined) callback(-1)
    return -1;



})



 
}
function selPrw(v){

    actual=v;//var ind=
     verifyprw(v,function(ind){
 
    if(ind>-1) {
        obactual=arw[ind];
        from="web"
 
        editor.value=arw[ind].cont;

        procesar(editor.value);
        onmen.click();
     //   selPr.value="Select a project";
    }

    });
}








    function GetJ(url, callback) {


            //var url  = "http://localhost:8080/api/v1/users";
            var xhr = new XMLHttpRequest()
            xhr.open('GET', url + '/1', true)
            xhr.onload = function() {
                //         (xhr.responseText)
                var users = JSON.parse(xhr.responseText);
                //     var obb=decoding(users.prim);


                if (xhr.readyState == 4 && xhr.status == "200") {
                    callback(users);
                } else {
                    console.error(users);
                }
            }
            xhr.send(null);
        }


         // Update a user
        function UpdateJ(url, ob, callback) {


            json = JSON.stringify(ob);
            var xhr = new XMLHttpRequest();
            xhr.open("PUT", url + '/12', true);
            xhr.setRequestHeader('Content-type', 'application/json; charset=utf-8');
            xhr.onload = function() {
                var users = JSON.parse(xhr.responseText);
                if (xhr.readyState == 4 && xhr.status == "200") {
                    //  alert("Tu Forma ha sido Enviada");
                    if (callback != undefined) callback(users);
                } else {
                    (users);
                }
            }
            xhr.send(json);
        }

var about=`About:
place your codes in the editor area, if you want to show your results in a text use "textarea" variable ( ex: texarea.value='my results')
if you want to show graphics use "canvas" variable ( ex: canvas.getContext('2d') )
ir you need to add some HTML tags use "container" varuable ( ex: var iege=document.createElement('input') ;container.appendChild(iage) )
**just scroll to expose texarea, canvas and (div)container elements.

To save your project locally:  menu > Select Option > Save Project;
To save you project in Web: menu > Select Option > Save in wev
You cant transfer from local to wev or web to local just select a project and saved where you want it.

`
//setUp3dCanvas();
function loadDoc(url,callback) {
        var xhttp = new XMLHttpRequest();
        xhttp.open("GET", url, false);
        xhttp.send();
        if(callback!=undefined)  callback(xhttp.responseText);
        return xhttp.responseText;
    }
    
function setUp3dCanvas(){

//threejs
loadDoc("https://raw.githubusercontent.com/ljaureguil/Panorama360/refs/heads/main/three.js",function(r){
   // eval(r);
var s = document.createElement("script");
s.innerHTML = r;
document.head.appendChild(s);
    //alert(r);
    //alert("three.js loaded");

  //  alert("three.js loaded");
    loadDoc("https://raw.githubusercontent.com/ljaureguil/Panorama360/refs/heads/main/TrackballControls.js",function(r){
     //   eval(r);
//alert(r)

s.innerHTML = r;
        eval(r)
document.head.appendChild(s);

       // alert("TrackballControls.js loaded");
//alert(THREE.TrackballControls)

        loadDoc("https://raw.githubusercontent.com/ljaureguil/Panorama360/refs/heads/main/js/DeviceOrientationControls.js",function(r){
        //    eval(r);alert(r)
s.innerHTML = r;
document.head.appendChild(s);
           // alert("DeviceOrientationControls.js loaded");
            init3dCanvas()


        
        })
    })

})

}


function init3dCanvas(){
      //init 3d canvas
   //   alert( THREE)
     // alert("init3dCanvas..................");
     scene = new THREE.Scene(), esena = new THREE.Group();scene.add(esena)
       camera = new THREE.PerspectiveCamera(75, canvas.width / canvas.height, 0.1, 1000);
     renderer = new THREE.WebGLRenderer({canvas:can3d});//can3
   
    renderer.setSize(canvas.width, canvas.height);//window.innerWidth,window.innerHeight);//canvas.width, canvas.height);

           s = new THREE.Mesh(
                new THREE.SphereGeometry(.3, 16, 16),
                new THREE.MeshPhongMaterial({
                      color: "#f0ff00"
                })
            );

const directionalLight = new THREE.DirectionalLight( 0xffffff, 0.5 );
scene.add( directionalLight );



            light4 = new THREE.PointLight(0xffffff, 2, 1000);
            light4.add(s);
            s.position.set(0, 4, -3);

            scene.add(light4);
 
             alight = new THREE.AmbientLight(0xaaaaaa);
            scene.add(alight)
    var geometry = new THREE.BoxGeometry();
    var material = new THREE.MeshPhongMaterial({ color: 0x00ff00 });
    var cube = new THREE.Mesh(geometry, material);
    esena.add(cube);

          controls = new THREE.TrackballControls(camera, renderer.domElement); //camera
            controls.zoomSpeed = .48;//1.2;
            controls.panSpeed = .36;//0.8;

            controls.keys = ['KeyA', 'KeyS', 'KeyD'];
          //  window.addEventListener('resize', onWindowResize, false);
          //  setTimeout(function(){ onWindowResize();},100) 

    camera.position.z = 5;

    function animate() {
        requestAnimationFrame(animate);
     controls.update();
     if(renderCodes!="") eval(renderCodes)
      //  cube.rotation.x += 0.01;
      //  cube.rotation.y += 0.01;
        renderer.render(scene, camera);
    //    textarea.value = "x: " + cube.rotation.x.toFixed(2) + ", y: " + cube.rotation.y.toFixed(2);
    }
   // alert("ready to animate");
    animate();
}




</script>

<script>


function crCube(params={w:1,h:1,d:1,texture:"",color:0xaaaaaa}){
     var geometry = new THREE.BoxGeometry(params.w,params.h,params.d);
    var material = new THREE.MeshPhongMaterial({ color: params.color });
 var loader = new THREE.TextureLoader();
    loader.load(params.textura, function(texture) {
        material.map = texture
    });
    var cube = new THREE.Mesh(geometry, material);
    return cube;
}

function crDot(params={d:.5,texture:"",color:0xaaaaaa}){
     var geometry = new THREE.SphereGeometry( params.d/2, 32, 16 ); 
    var material = new THREE.MeshPhongMaterial({ color: params.color });
 var loader = new THREE.TextureLoader();
    loader.load(params.textura, function(texture) {
        material.map = texture
    });
    var dot = new THREE.Mesh(geometry, material);
    return dot;
}

function crSphere(params={r:1,segsx:32,segsy:16,texture:"",color:0xaaaaaa}){
     var geometry = new THREE.SphereGeometry( params.r, params.segsx, params.segsy ); 
    var material = new THREE.MeshPhongMaterial({ color: params.color });
 var loader = new THREE.TextureLoader();
    loader.load(params.textura, function(texture) {
        material.map = texture
    });
    var sphere = new THREE.Mesh(geometry, material);
    return sphere;
}

function crCylinder(params={r1:1,r2:1,long:1,cap:true,segsx:32,segsy:16,texture:"",color:0xaaaaaa}){
     var geometry = new THREE.CylinderGeometry( params.r1,params.r2, params.segsx, params.segsy, params.cap ); 
    var material = new THREE.MeshPhongMaterial({ color: params.color });
 var loader = new THREE.TextureLoader();
    loader.load(params.textura, function(texture) {
        material.map = texture
    });
    var cylinder = new THREE.Mesh(geometry, material);
    return cylinder;
}

function crLine(params={arPoints:[[0,0,0],[1,1,1]],color:0xaaaa}){
var points=[];
params.arPoints.forEach(e => {
   points.push( new THREE.Vector3( e[0], e[1], e[2] ) );
});
const material = new THREE.LineBasicMaterial({
	color: params.color
});

const geometry = new THREE.BufferGeometry().setFromPoints( points );

const line = new THREE.Line( geometry, material );	
return line;	

}


function clrEsena(){
var ar=esena.children,i=0;
for(var i=0;i<ar.length;i++){


}

esena.children.forEach(e =>{
 //   alert(JSON.stringify(e))
    e.geometry.dispose();e.material.dispose();
    esena.remove(e)
   // group.remove(e)
})
}

function insertTx(v){
      var t=editor.value;
        var i=editor.selectionStart;
        var p1=t.slice(0,i);p2=t.slice(editor.selectionEnd,editor.value.length)
        var e=p1 +v+ p2;
        editor.value=e;
        editor.focus();
        editor.selectionEnd=i+v.length;


}


</script>
<script>

    Mat = {
        // pii: Math.PI,
        toRad(a) {
            return a * Math.PI / 180
        },
        toDeg(a) {
            return 180 * a / Math.PI
        },
        getObsG(p1, p2) {
            var dx = p2.x - p1.x,
                dy = p2.y - p1.y,
                dz = p2.z - p1.z;
            if (dx === 0) dx = .000000000000001;
            //     alert(dx)


            var d = Math.sqrt(dx * dx + dy * dy + dz * dz);
            var v = Math.PI / 2 - Math.asin(dy / d); //arcsin (dz / d);
            var az = Math.atan(dz / dx); //arctan((x2 –x1)/(y2 –y1));

            var c = 1;

            if (dx >= 0 && dz >= 0) c = 2;
            if (dx >= 0 && dz <= 0) c = 1;
            if (dx <= 0 && dz <= 0) c = 4;
            if (dx <= 0 && dz >= 0) c = 3;
            //         alert("dx "+dx+"\ndz "+dz+"\nc "+c)  
            var Az = this.radToAz(az, c);

            //     alert("flib\n\n"+Az)

            return {
                A: Az,
                V: this.toDeg(v),
                D: d,
                az: this.toRad(Az),
                v: v,
                d: d,
                dx: Math.cos(dy / d),
                dy: dy
            }
        },
        getObs(p1, p2, Gr) {
            var dx = p2.x - p1.x,
                dy = p2.y - p1.y,
                dz = p2.z - p1.z;
            if (dy === 0) dy = .0000000000001;


            var d = Math.sqrt(dx * dx + dy * dy + dz * dz);
            var v = Math.PI / 2 - Math.asin(dz / d); // alert(v)//arcsin (dz / d);
            var az = Math.atan(dx / dy); //arctan((x2 –x1)/(y2 –y1));
            var c = 1;
            if (dx >= 0 && dy >= 0) c = 1;
            if (dx >= 0 && dy <= 0) c = 2;
            if (dx <= 0 && dy <= 0) c = 3;
            if (dx <= 0 && dy >= 0) c = 4;
            //  alert(dy+"\nFrom MyLib:\n\n"+this.getAzRadians(az, c))

            return {
                Az: this.toDeg(this.getAzRadians(az, c)),
                V: this.toDeg(v),
                D: d,
                dhz: Math.sqrt(dy * dy + dx * dx),
                dx: dx, //Math.cos(dy / d),
                dy: dy,
                dz: dz,
                az: this.getAzRadians(az, c),
                v: v


            }
        },
        getAzDeg(an, c) {
            if (an < 0) an = an * -1;
            if (c == 1) an = an;
            if (c == 2) an = 180 - an;
            if (c == 3) an = 180 + an;
            if (c == 4) an = 360 - an;
            return an;

        },
        getAzRadians(a, c) {
            var an = a;
            if (an < 0) an = an * -1;
            if (c == 1) an = an;
            if (c == 2) an = Math.PI - an;
            if (c == 3) an = Math.PI + an;
            if (c == 4) an = 2 * Math.PI - an;
            return an;
        },

        radToAz(a, c) {


            var an = this.toDeg(a);
            //   alert(an+"\n\n"+c)
            if (an < 0) an = an * (-1);
            if (c == 1) an = 90 - an;
            if (c == 2) an = 90 + an;
            if (c == 3) an = 270 - an;
            if (c == 4) an = 270 + an;
            if (an === 360) an = 0;
            return an;

        },
        degToAz(an, c) {
            if (an < 0) an = an * -1;
            if (c == 1) an = an;
            if (c == 2) an = 180 - an;
            if (c == 3) an = 180 + an;
            if (c == 4) an = 360 - an;
            return an;

        },

        //This function takes in latitude and longitude of two location and returns the distance between them as the crow flies (in km)
        calcCrow(lat1, lon1, lat2, lon2) {
            var R = 6371; // km
            var dLat = this.toRad(lat2 - lat1);
            var dLon = this.toRad(lon2 - lon1);
            var lat1 = this.toRad(lat1);
            var lat2 = this.toRad(lat2);

            var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.sin(dLon / 2) * Math.sin(dLon / 2) * Math.cos(lat1) * Math.cos(lat2);
            var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            var d = R * c;
            return d;
        },
        getPos(p, a, v, d) {
            var pos = {},
                or = {};
            or.p = p;
            or.az = a;
            or.v = v;
            or.d = d;
            a = 90 - a;
            v = this.toRad(v)
            var dx = Math.sin(v) * d;
            var h = Math.cos(v) * d;
            a = this.toRad(a);

            pos.x = dx * Math.cos(a) + p.x;
            pos.y = dx * Math.sin(a) + p.y;
            pos.z = h + p.z; //dx*Math.sin(a)+p.z;
            pos.dx = dx;
            pos.dy = h;
            pos.or = or;

            return pos;

        },
        getPosG(p, a, v, d) {
            var pos = {};
            a = 90 - a;
            v = this.toRad(v)
            var dx = Math.cos(v) * d;
            a = this.toRad(a);

            pos.x = dx * Math.cos(a) + p.x;
            pos.y = d * Math.sin(v) + p.y;
            pos.z = dx * Math.sin(a) + p.z;
            return pos;

        },
        repObj(ob) {
            var s = JSON.stringify(ob).replace(/"/g, " ").replace(/:/g, ": ").replace(/,/g, "\n").replace(/{/g, "\n").replace(/}/g, "\n");
            return s;
        },
        interByDis(a, b, c) {
            var x1 = (a * a + c * c - b * b) / (2 * c)
            var x2 = c - x1;
            var ra = Math.acos(x1 / a),
                A = this.toDeg(ra);
            var rc = Math.acos(x2 / b),
                C = this.toDeg(rc);
            var rb = 2 * Math.PI - ra - rc;
            var B = 180 - A - C;
            return {
                A: A,
                B: B,
                C: C,
                a: ra,
                b: rb,
                c: rc
            }
        },
        interByAng(p1, p2, an1, an2) {
            var a1 = an1.az,
                a2 = an2.az,
                v1 = an1.v,
                v2 = an2.v;

            alert(JSON.stringify());
            alert(JSON.stringify(p1));
            alert(JSON.stringify(p2));
            alert(JSON.stringify(a1));
            alert(JSON.stringify(a2));
            var dx = p2.x - p1.x;
            var dy = p2.y - p1.y;
            var d = Math.sqrt(dx * dx + dy * dy)
            var a = Math.atan(dy / dx);
            var da = 180 - (a1 + a2);

            var x = Math.tan(a2) * d / (Math.tan(a1) + Math.tan(a2))
            var y = Math.tan(a1) * x;
            ///////////
            var xx = x - p1.x;
            var yy = y - p1.y;
            var rr = Math.sqrt(xx * xx + yy * yy);

            var z = p1.z - rr / Math.tan(an1.v);

            //////////

            var p = {}
            p.x = x
            p.y = y
            p.z = z
            p.a = Math.atan(y / x);
            var d = Math.sqrt(x * x + y * y);
            p.r = d;
            var xx = d * Math.cos(a + p.a);
            var yy = d * Math.sin(a + p.a);
            p.xx = xx;
            p.yy = yy;

            return p

        },
        interByAngLn(inf = {
            line1: {
                p1,
                p2
            },
            line2: {
                p1,
                p2
            }
        }) {
            // var dx=
        }

    }
</script>
</HTML>
